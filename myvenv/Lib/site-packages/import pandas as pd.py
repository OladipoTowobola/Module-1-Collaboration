import pandas as pd
import matplotlib.pyplot as plt
import numpy as np  
import seaborn as sns
from collections import Counter

file_path = "C://Users//Otowo//OneDrive//Desktop//Advanced Data Analytics DBMS260//cereal.csv"
df = pd.read_csv(file_path)
df.info()
df.describe()
df.isna().sum()

df['manufacturer'] = df['manufacturer'].replace({
    'Kelloggs': 'K',
    'Kellogg': 'K'
})

# ===== EXPLORE DISTRIBUTIONS OF NUTRITIONAL VALUES =====
print("\n=== NUTRITIONAL VALUES SUMMARY ===")
nutritional_cols = ['calories', 'protein', 'fat', 'sodium', 'fiber', 'carbo', 'sugars', 'potass', 'vitamins']
print(df[nutritional_cols].describe())

# ===== ADDITIONAL DATA CLEANING =====
print("\n=== CHECKING FOR DUPLICATES ===")
print(f"Duplicate rows: {df.duplicated().sum()}")
print(f"Duplicate names: {df['name'].duplicated().sum()}")

# ===== CREATE VISUALIZATIONS =====
fig, axes = plt.subplots(2, 3, figsize=(15, 10))

# Histograms for key nutritional values
axes[0, 0].hist(df['calories'], bins=20, edgecolor='black', color='skyblue')
axes[0, 0].set_title('Distribution of Calories')
axes[0, 0].set_xlabel('Calories')
axes[0, 0].set_ylabel('Frequency')

axes[0, 1].hist(df['protein'], bins=15, edgecolor='black', color='lightgreen')
axes[0, 1].set_title('Distribution of Protein')
axes[0, 1].set_xlabel('Protein (g)')
axes[0, 1].set_ylabel('Frequency')

axes[0, 2].hist(df['sugars'], bins=15, edgecolor='black', color='coral')
axes[0, 2].set_title('Distribution of Sugars')
axes[0, 2].set_xlabel('Sugars (g)')
axes[0, 2].set_ylabel('Frequency')

# Box plots by manufacturer
axes[1, 0].boxplot([df[df['manufacturer'] == mfg]['calories'] for mfg in df['manufacturer'].unique()], 
                    labels=df['manufacturer'].unique())
axes[1, 0].set_title('Calories by Manufacturer')
axes[1, 0].set_ylabel('Calories')

axes[1, 1].boxplot([df[df['manufacturer'] == mfg]['sugars'] for mfg in df['manufacturer'].unique()], 
                    labels=df['manufacturer'].unique())
axes[1, 1].set_title('Sugars by Manufacturer')
axes[1, 1].set_ylabel('Sugars (g)')

axes[1, 2].boxplot([df[df['manufacturer'] == mfg]['protein'] for mfg in df['manufacturer'].unique()], 
                    labels=df['manufacturer'].unique())
axes[1, 2].set_title('Protein by Manufacturer')
axes[1, 2].set_ylabel('Protein (g)')

plt.tight_layout()
plt.show()

# ===== CORRELATION HEATMAP =====
plt.figure(figsize=(12, 8))
correlation_matrix = df[nutritional_cols].corr()
sns.heatmap(correlation_matrix, annot=True, fmt='.2f', cmap='coolwarm', center=0)
plt.title('Correlation Matrix of Nutritional Values')
plt.tight_layout()
plt.show()

# ===== GROUP DATA BY MANUFACTURER =====
print("\n=== MANUFACTURER STATISTICS ===")
manufacturer_stats = df.groupby('manufacturer')[nutritional_cols].mean().round(2)
print(manufacturer_stats)

# Count cereals by manufacturer
print("\n=== CEREAL COUNT BY MANUFACTURER ===")
print(df['manufacturer'].value_counts())

# ===== ANALYZE RELATIONSHIPS BETWEEN VARIABLES =====
print("\n=== CORRELATION WITH RATING ===")
correlation_with_rating = df[nutritional_cols + ['rating']].corr()['rating'].sort_values(ascending=False)
print(correlation_with_rating)

# Scatter plots: key nutritional relationships
fig, axes = plt.subplots(2, 2, figsize=(12, 10))

axes[0, 0].scatter(df['calories'], df['rating'], alpha=0.6, color='blue')
axes[0, 0].set_title('Calories vs Rating')
axes[0, 0].set_xlabel('Calories')
axes[0, 0].set_ylabel('Rating')

axes[0, 1].scatter(df['sugars'], df['rating'], alpha=0.6, color='red')
axes[0, 1].set_title('Sugars vs Rating')
axes[0, 1].set_xlabel('Sugars (g)')
axes[0, 1].set_ylabel('Rating')

axes[1, 0].scatter(df['protein'], df['rating'], alpha=0.6, color='green')
axes[1, 0].set_title('Protein vs Rating')
axes[1, 0].set_xlabel('Protein (g)')
axes[1, 0].set_ylabel('Rating')

axes[1, 1].scatter(df['fiber'], df['rating'], alpha=0.6, color='orange')
axes[1, 1].set_title('Fiber vs Rating')
axes[1, 1].set_xlabel('Fiber (g)')
axes[1, 1].set_ylabel('Rating')

plt.tight_layout()
plt.show()

# ===== BOXPLOT: RATINGS BY MANUFACTURER =====
sns.boxplot(x='manufacturer', y='rating', data=df)
plt.title("Cereal Ratings by Manufacturer")
plt.show()

df.head()